========
永続化
========

永続化のオプション
====================

* スナップショット

  * ある瞬間のデータを取り出してディスクに書き出す

* 追記専用ファイル(AOF)

  * 書き込みコマンドを受け取ったときにディスクにコピーする



スナップショット
==================

* スナップショットを始める方法

  * BGSAVEコマンド

    * forkして子プロセスがスナップショットをディスクに書き込む

  * SAVEコマンド

    * SAVEコマンドを実行すると、スナップショット処理が完了するまですべてのコマンドに対する応答を停止する

  * 設定のsave行のルールにあてはまるタイミングでBGSAVEが起動される

  * SHUTDOWNコマンドでシャットダウン要求を受け取るか、標準のTERMシグナルを受け取るとSAVEを実行する

  * 他のRedisサーバーに接続し、SYNCコマンドを呼び出してレプリケーションを開始すると、マスターサーバーはBGSAVEを開始する


追記専用ファイル
==================

* ファイルの末尾に変更点を追記して発生したデータの変更記録を管理する
* appendonly yesを設定すれば有効になる

* すべての書き込みがディスクにコマンドのログを作り出すため、追記専用ファイルは継続的にふくらんでいく
* リスタートのたびにAOFのすべてのコマンドを順に実行するため、大きなAOFを処理する場合は、起動のために非常に長い時間がかかってしまうことがある

  * BGREWRITEAOFで冗長なコマンドを削除してAOFをできる限り短く書き換えることができる


スナップショットと追記専用ファイルのチェック
============================================

::

  redis-check-aof [--fix] <file.aof>

  redis-check-dump <dump.rdb>

