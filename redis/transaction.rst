==================
トランザクション
==================

* 同じ型あるいは異なる型の複数のキーを対象とする操作を中断せずに実行するためのコマンド

  * WATCH、MULTI、EXEC、UNWATCH、DISCARD

* リレーショナルデータベースの場合、ロールバックかコミットのどちらかになる
* Redisでは、MULTI/EXECトランザクションの一部として渡されたすべてのコマンドが、全部終了するまで次々に実行される。すべてのコマンドが実行されたら、他のクライアントがコマンドを実行できるようになる
* WATCHキーで監視しているとき、EXECを実行する前に対象となっていたキーが他のクライアントによって置換、更新、削除されると、EXECを実行しようとしたときに、Redisに加えた変更はエラーを起こす
* UNWATCHがWATCHの後、MULTIの前に送られると接続をリセットする
* DISCARDはMULTIの後、EXECの前に送られたときに接続をリセットする


楽観的なロック
================

* ロックしているクライアントが遅いと、複数行のロックを獲得しようとしているクライアントが長時間待たされる可能性がある
* Redisはクライアントの待ち時間を最小限に抑えるように設計されているので(ブロックを起こすLISTポップを除く)、WATCHの間データをロックしない
* 代わりに、他のクライアントがデータを書き換えたことをクライアントに通知する

