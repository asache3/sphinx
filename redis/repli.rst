==================
レプリケーション
==================

レプリケーション設定
======================

* 設定ファイルでslaveof host portを設定する
* マスターによるデータ更新を停止したい場合には、SLAVEOF no oneを使う


レプリケーションのプロセス
============================

.. csv-table::
  :header-rows: 1

  ステップ,マスターの動作,スレーブの動作
  1,(コマンドが届くのを待つ),マスターに接続し、SYNCコマンドを発行する
  2,BGSAVEの実行を開始する。前のBGSAVE以降のすべての書き込みコマンドの記録を管理する,古いデータ(あれば)を返すか、コマンドにエラーを返す(設定によって変わる)
  3,BGSAVEが終了する。スレーブにスナップショットを送り始める。書き込みコマンドの記録を管理し続ける,すべての古いデータ(あれば)を破棄する。受信したスナップショットのロードを開始する
  4,スレーブへのスナップショットの送信が終了する。スレーブに書き込みコマンドの記録を送り始める,スナップショットのパースを終了する。通常通りのコマンドへの応答を再開する
  5,書き込みの記録の送信が終了する。書き込みコマンドのライブストリーミングを開始する,マスターから送られてきた書き込みコマンドの記録の実行を終了する。コマンドの実行を継続する


* マスターはシステムの50〜65%のメモリだけを使い、30〜45%はBGSAVEとコマンドの記録のためのスペアメモリとして残しておくことがベストプラクティス
* マスターマスターレプリケーションをサポートしていない

